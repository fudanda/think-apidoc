<div class="layuimini-container layuimini-page-anim">
    <div class="layuimini-main">
        <div class="layui-tab layui-tab-card">
            <ul class="layui-tab-title">
                <li class="layui-this" lay-id="detail">接口详情</li>
                <li lay-id="debug">在线调试</li>
            </ul>
            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show" id="view_information"></div>
                <div class="layui-tab-item" id="view_debug" lay-filter="debug">
                    <form class="layui-form">
                        <div class="layui-form-item">
                            <label class="layui-form-label">接口地址</label>
                            <div class="layui-input-block">
                                <input type="url" name="ApiUrl" required lay-verify="url" placeholder="请输入接口地址"
                                    autocomplete="off" class="layui-input" value="">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">请求方式</label>
                            <div class="layui-input-block">
                                <select name="ApiMethod" lay-verify="required">
                                    <option value="GET">GET</option>
                                    <option value="POST">GET</option>
                                    <option value="PUT">PUT</option>
                                    <option value="DELETE">DELETE</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">请求头部</label>
                            <div class="layui-input-block">
                                <table class="" id="header" lay-filter="header"></table>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">请求参数</label>
                            <div class="layui-input-block">
                                <table class="" id="param" lay-filter="param"></table>
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                <button class="layui-btn" lay-submit lay-filter="debug">立即提交</button>
                                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </div>

        <div id="view_log"></div>

        <div id="view_prompt">
            <fieldset class="layui-elem-field">
                <legend>温馨提示</legend>
                <div class="layui-field-box">
                    <blockquote class="layui-elem-quote">此文档是由系统自动生成，如发现错误或疑问请告知开发人员及时修改</blockquote>
                </div>
            </fieldset>
        </div>
    </div>
</div>
<script type="text/html" id="information">
<table class="layui-table">
    <colgroup><col width="100"><col></colgroup>
      <thead>
    <tr>
      <th>类型</th>
      <th>数值</th>
    </tr>
  </thead>
    <tbody>
        <tr>
            <td>接口地址</td>
            <td><a target="_blank" href=""></a>
            </td>
        </tr>
        <tr>
            <td>请求方式</td>
            <td>{{ method(d.ApiMethod) }}</td>
        </tr>
        <tr>
            <td>接口版本</td>
            <td>{{ d.ApiVersion ? d.ApiVersion : '-' }}</td>
        </tr>
        <tr>
            <td>开发人员</td>
            <td>{{ d.ApiAuthor ? d.ApiAuthor : '-' }}</td>
        </tr>
        <tr>
            <td>请求参数</td>
            <td><table class="layui-hide" id="request" lay-filter="request"></table></td>
        </tr>
        <tr>
            <td>响应参数</td>
            <td><table class="layui-hide" id="response" lay-filter="response"></table></td>

        </tr>
    </tbody>
</table>
</script>

<script type="text/html" id="debug">
<form class="layui-form">
    <div class="layui-form-item">
        <label class="layui-form-label">接口地址</label>
        <div class="layui-input-block">
            <input type="url" name="url" required lay-verify="url" placeholder="请输入接口地址" autocomplete="off"
                class="layui-input" value="{{ d.ApiUrl ? d.ApiUrl : ''}}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">请求方式</label>
        <div class="layui-input-inline">
            <select name="method" lay-verify="required">
                {{# layui.each(['GET','POST','PUT','DELETE'],function(index,item){ }}
                <option value="{{ item }}" {{# if(item.trim()== d.ApiMethod.trim()){ }}selected{{# } }}>{{ item }}
                </option>
                {{# }); }}
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="debug">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>
</form>
</script>

<script type="text/html" id="log">
    <fieldset class="layui-elem-field">
        <legend>更新日志</legend>
        <div class="layui-field-box">
            {{# if(d.ApiLog){ }}
            <ul class="layui-timeline">
                {{# layui.each(d.ApiLog,function(k,v){ }}
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                    <div class="layui-timeline-content layui-text">
                        <h3 class="layui-timeline-title"> {{ v.title }}</h3>
                        <p>
                            {{ v.desc }}
                        </p>
                    </div>
                </li>
                {{# }); }}
            </ul>
            {{#  } else { }}
            暂无
            {{#  } }}
        </div>
    </fieldset>
</script>

<script>
    layui.use(['form', 'table', 'miniPage', 'element', 'laytpl'], function () {
        var $ = layui.jquery,
            form = layui.form,
            table = layui.table,
            laytpl = layui.laytpl;

        var href = location.hash.replace(/^#\//, '');

        $.ajax({
            url: href,
            type: 'POST',
            dataType: 'json',
            success: function (res) {
                //接口信息
                render(information.innerHTML, 'view_information', res.data);
                //更新日志信息
                render(log.innerHTML, 'view_log', res.data);
                //请求参数
                var request = res.data.ApiParam;
                //响应参数
                var response = res.data.ApiReturn;


                table.render({
                    elem: '#request',
                    data: request,
                    cols: [[ //表头
                        { field: 'name', title: '名称', sort: true },
                        {
                            field: 'type', title: '类型', templet: function (d) {
                                return paramType(d.type);
                            }
                        },
                        { field: 'default', title: '默认值' },
                        { field: 'desc', title: '说明' },
                    ]]
                });
                table.render({
                    elem: '#response',
                    data: response,
                    cols: [[ //表头
                        { field: 'name', title: '名称', sort: true },
                        {
                            field: 'type', title: '类型', templet: function (d) {
                                return paramType(d.type);
                            }
                        },
                        { field: 'default', title: '默认值' },
                        { field: 'desc', title: '说明' },
                    ]]
                });


                //调试信息
                form.val('debug', res.data)

                // table.render({
                //     elem: '#header',
                // });
                table.render({
                    elem: '#param',
                    data: request,
                    cols: [[ //表头
                        { field: 'name', title: '名称', sort: true },
                        {
                            field: 'type', title: '类型', templet: function (d) {
                                return paramType(d.type);
                            }
                        },
                        {
                            field: 'desc', title: '操作', templet: function (d) {
                                return paramType(d.type);
                            }
                        },
                    ]]
                });
            },
            error: function (xhr, textstatus, thrown) {
                return layer.msg('Status:' + xhr.status + '，' + xhr.statusText + '，请稍后再试！');
            }
        });

        function render(tpl, _view, data) {
            var view = document.getElementById(_view);
            laytpl(tpl).render(data, function (html) {
                view.innerHTML = html;
            })
        }
        window.method = function (param) {
            var method = {
                'GET': 'class="layui-badge layui-bg-green"',
                'POST': 'class="layui-badge layui-bg-blue"',
                'PUT': 'class="layui-badge layui-bg-orange"',
                'DELETE': 'class="layui-badge"',
            };
            if (!method[param]) {
                return '-';
            }
            return '<span ' + method[param] + '>' + param + '</span>';
        }

        window.paramType = function (param) {
            var method = {
                'int': 'class="layui-badge layui-bg-green"',
                'string': 'class="layui-badge layui-bg-blue"',
                'number': 'class="layui-badge layui-bg-orange"',
                'array': 'class="layui-badge"',
            };
            if (!method[param]) {
                return '-';
            }
            return '<span ' + method[param] + '>' + param + '</span>';
        }

    });
</script>